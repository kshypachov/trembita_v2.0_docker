{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .local_ini.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .local_ini.name}}
data:
  {{ default "local.ini" .local_ini.subPath}}: |
    ;[identity-provider]
    ;security-server-client-id = 60997vl7jlgoi53zbyvv2k9iyny1rae2
    ;security-server-client-secret = QTK3fBuPu0v0m2DpvEees0AODujEcX3V
    ;public-client-redirect-uris= https://{{$.Values.trembita_config.trembita_frontend_pod.ingress.host}}
    ;hostname={{$.Values.trembita_config.trembita_frontend_pod.ingress.host}}


    ;[message-log]
    ;archive-storage-type = s3
    ;archive-interval=0 * * * * ? *

    ;[message-log-s3]
    ;bucket-name = uxp-messagelog
    ;access-key = scmyyP91huXNGdcGgLUu
    ;secret-key = jFiGQMn8pPngBFUFN1NcrxEjfWPKm11tIolVGmcm
    ;address = http://minio:9000

{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_identity_provider_rest_api.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_identity_provider_rest_api.name }}
data:
  {{default "uxp-identity-provider-rest-api-location.include" .uxp_identity_provider_rest_api.subPath}}: |
    # Identity Provider backend location.
    location /auth-api {
      proxy_pass http://127.0.0.1:8087;
    #  proxy_set_header Host $host:$server_port;
    #  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #  proxy_set_header X-Forwarded-Proto https;
    #  proxy_set_header X-Forwarded-Port $server_port;
    #  proxy_redirect http:// https://;
      client_max_body_size 5M;

      location ~* oauth2-redirect.html$ {
        proxy_pass http://127.0.0.1:8087;
    #    proxy_set_header Host $host:$server_port;
    #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #    proxy_set_header X-Forwarded-Proto https;
    #    proxy_set_header X-Forwarded-Port $server_port;
    #    proxy_redirect http:// https://;
    #    client_max_body_size 5M;
        add_header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; frame-ancestors 'self'; script-src 'self' 'unsafe-inline';" always;
      }
    }

{{- end }}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_seg_rest_api_ng_include.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_seg_rest_api_ng_include.name}}
data:
  {{default "uxp-securityserver-rest-api-location.include" .uxp_seg_rest_api_ng_include.subPath}}: |
    # REST API location.
      location /api {
        proxy_pass http://127.0.0.1:8085;
        #proxy_set_header Host $host:$server_port;
        #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #proxy_set_header X-Forwarded-Proto https;
        #proxy_set_header X-Forwarded-Port $server_port;
        #proxy_redirect http:// https://;
        #client_max_body_size 5M;

        location ~* oauth2-redirect.html$ {
          proxy_pass http://127.0.0.1:8085;
          #proxy_set_header Host $host:$server_port;
          #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          #proxy_set_header X-Forwarded-Proto https;
          #proxy_set_header X-Forwarded-Port $server_port;
          #proxy_redirect http:// https://;
          #client_max_body_size 5M;
          add_header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; frame-ancestors 'self'; script-src 'self' 'unsafe-inline';" always;
        }
      }
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .db_properties.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .db_properties.name}}
data:
  {{default "db.properties" .db_properties.subPath}}: |
    serverconf.hibernate.jdbc.use_streams_for_binary = true
    serverconf.hibernate.connection.driver_class = org.postgresql.Driver
    serverconf.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/serverconf
    serverconf.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.SERVERCONF_DB_USER }}
    serverconf.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.SERVERCONF_DB_PASS }}
    messagelog-metadata.hibernate.connection.driver_class = org.postgresql.Driver
    messagelog-metadata.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/messagelog-metadata
    messagelog-metadata.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.MESSAGELOG_DB_USER }}
    messagelog-metadata.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.MESSAGELOG_DB_PASS }}
    identity-provider.hibernate.connection.driver_class = org.postgresql.Driver
    identity-provider.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/identity-provider
    identity-provider.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.IDENTITY_DB_USER }}
    identity-provider.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.IDENTITY_DB_PASS }}
    op-monitor.hibernate.jdbc.use_streams_for_binary = true
    op-monitor.hibernate.connection.driver_class = org.postgresql.Driver
    op-monitor.hibernate.jdbc.batch_size = 50
    op-monitor.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/op-monitor
    op-monitor.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.OPMONITOR_DB_USER }}
    op-monitor.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.OPMONITOR_DB_PASS }}
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_conf_client_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_conf_client_logback.name}}
data:
  {{ default "confclient-logback.xml" .uxp_conf_client_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">
      <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
          <encoder>
              <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
              <charset>UTF-8</charset>
          </encoder>
      </appender>

      <logger name="ee.cyber.uxp" level="INFO"/>

      <root level="INFO">
          <appender-ref ref="CONSOLE"/>
      </root>
    </configuration>

{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_message_log_archiver_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_message_log_archiver_logback.name}}
data:
  {{ default "messagelog-archiver-logback.xml" .uxp_message_log_archiver_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>
    </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_identity_provider_rest_api_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_identity_provider_rest_api_logback.name}}
data:
  {{ default "identity-provider-rest-api-logback.xml" .uxp_identity_provider_rest_api_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_ocsp_cache_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_ocsp_cache_logback.name}}
data:
  {{ default "ocsp-cache-logback.xml" .uxp_ocsp_cache_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_verifier_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_verifier_logback.name}}
data:
  {{ default "verifier-rest-api-logback.xml" .uxp_verifier_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_seg_rest_api_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_seg_rest_api_logback.name}}
data:
  {{ default "securityserver-rest-api-logback.xml" .uxp_seg_rest_api_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_proxy_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_proxy_logback.name}}
data:
  {{ default "proxy-logback.xml" .uxp_proxy_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_monitor_agent_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_monitor_agent_logback.name}}
data:
  {{ default "proxy-monitor-agent-logback.xml" .uxp_monitor_agent_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_monitor_agent_addon_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_monitor_agent_addon_logback.name}}
data:
  {{ default "proxy-monitor-agent-logback.xml" .uxp_monitor_agent_addon_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_anchor.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_anchor.name}}
data:
  {{ default "configuration-anchor.xml" .uxp_anchor.subPath}}: |
      <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
      <ns3:configurationAnchor xmlns:ns2="http://x-road.eu/xsd/identifiers" xmlns:ns3="http://x-road.eu/xsd/xroad.xsd">
          <generatedAt>2025-03-10T13:15:47.524Z</generatedAt>
          <instanceIdentifier>test1</instanceIdentifier>
          <source>
              <downloadURL>http://192.168.99.180/internalconf</downloadURL>
              <verificationCert>MIIBWjCB4KADAgECAgEBMAoGCCqGSM49BAMCMA4xDDAKBgNVBAMMA04vQTAeFw03MDAxMDEwMDAwMDBaFw0zODAxMDEwMDAwMDBaMA4xDDAKBgNVBAMMA04vQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABARD0p8U6kXze6tmVux2csWxTNHawwzphueTO+lJoUCqgXUv69EN7p1kAxTUbjfqIWjWTTzJYJEj/ofq3945uCoNAhFxsvsTOSSlxRjTGc17EBpE8YoYfaj3wQdqwTIreaMSMBAwDgYDVR0PAQH/BAQDAgZAMAoGCCqGSM49BAMCA2kAMGYCMQCiWn/Tzs7q62BOY180ED3a//8Gl2HkRpukooTdmfm1hU8HafsPq2/d3Gfj1V8pOmQCMQCvFvVOBaBrFirTVxPNl7R6fg2hPA8rL4mUtNGaJfpoi4Z8haVSlvAdiozuG4NFqlM=</verificationCert>
          </source>
          <source>
              <downloadURL>http://192.168.99.181/internalconf</downloadURL>
              <verificationCert>MIIBWTCB4KADAgECAgEBMAoGCCqGSM49BAMCMA4xDDAKBgNVBAMMA04vQTAeFw03MDAxMDEwMDAwMDBaFw0zODAxMDEwMDAwMDBaMA4xDDAKBgNVBAMMA04vQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABAZWm0DzpR+Nizfy+Vy/opYg7sguewvmujuExJg0fN53f/o6Kr+iaVwbkYqeKEUmEqIXAnucj9EQqeYMiVP6CL/8jT2xEuyd3qt8rNRybl2pPM8CNo7jCRwcgaruGp97oKMSMBAwDgYDVR0PAQH/BAQDAgZAMAoGCCqGSM49BAMCA2gAMGUCMQCYi8BCHVvEj9OXQeSZYhpJHgH6pb47gTbmiTWug3AvQQqh/1bj61C8wUaU24miFD8CMGwADMJtfcd2iTBNIsBR7ULyu43SxVgmPQ8cncc4J7o+j3PIhDTZiFdbgnYty5DE6A==</verificationCert>
          </source>
      </ns3:configurationAnchor>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_license.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_license.name}}
data:
  {{ default "license.lic" .uxp_license.subPath}}: |
      --BOUNDARY
      content-id: UXP-LICENSE
      license-version: 2.0

      {
        "common": {
          "licenseNumber": "7304-2163-2956-3274",
          "licenseHolder": "Міністерство цифрової трансформації України",
          "validUntil": "2025-06-30"
        },
        "products": {
          "uxp-security-server": {
            "licensedOwners": [
              {
                "instances": [
                  "test1"
                ]
              }
            ],
            "maxClients": "unlimited"
          },
          "uxp-data-privacy-solution": {
            "licensedMembers": [
              {
                "instances": [
                  "test1"
                ]
              }
            ],
            "consentManagement": true,
            "maxServices": "unlimited",
            "maxProviders": "unlimited",
            "maxClients": "unlimited"
          }
        }
      }
      --BOUNDARY
      content-id: SIGNATURE
      signing-key: 035fdfc0-9b5e-4b78-9f73-bdc2d90363fe
      signing-algorithm: SHA512withRSA

      bJUISmXgEGzsW5tB6DPkZc38y5MXUADmPojMbtLrg1v+eVaXmy1iqUA8pAPBgb9ogY4a3jMqyi3YW0bjwzMfGj8G2pGVxvhLp525zolbZV7wSnttA/LulQF9DJoaRySb3LrODMRLjIsUNTw4vxHNhgtTqqTrg1ItoirgruE5KN2zJVM3hTI6MrFkMnU5wwbCFADUPqsg89swKekNXO0Jo3g/uIFB193XT7xtejpBrjWtuORfS6PKaIqs0OQzKskSj9N4HiyHOJbFp3QAx52CDj2H2+R8alHJ8LMxVJTjPuLdxYuuVj77NCSzXFllCN9XKIsfgSBUc7z/9CpCiZWtqNzQRFPgizgBGWitXuXAed+55wGeEoXrEpoMi381Y/kZSRL/alPDu1368Nyvvc6lVE/q62MNFIo4HqlULrMet6zM5xklqFKx1bQH6qUq27qFPHXKLXbAU7+KjbY0N15wtQEKrRwqBdfgEZz5NBa4B05Kg1Sl0oFT+EKHBn3Bmn8EwFKIyb/OCIGoSKdLPWjbEWwCdgtO3lDi8wv12GoSCzGQnqr5AJBi3NdybdpnRXcVLQXmnY3lEM7e1BxynZWGdeIw/AgrzEIbwIUAGJqi1wOlA4SpKrF9YEZ/w9FkrK7lwBYE3NzcQOTAl9vtR9U0RSLvudxNYdmpurtfZMcz7lA=
      --BOUNDARY--
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .osplm_ini.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .osplm_ini.name}}
data:
  {{ default "osplm.ini" .osplm_ini.subPath}}: |
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301]
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules]
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules\091]
      OrderNumber=0
      SN=091
      Address=192.168.99.236
      AddressMask=255.255.255.0
{{- end}}
{{- end}}