{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .local_ini.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .local_ini.name}}
data:
  {{ default "local.ini" .local_ini.subPath}}: |
    ;[identity-provider]
    ;security-server-client-id = 60997vl7jlgoi53zbyvv2k9iyny1rae2
    ;security-server-client-secret = QTK3fBuPu0v0m2DpvEees0AODujEcX3V
    ;public-client-redirect-uris= https://{{$.Values.trembita_config.trembita_frontend_pod.ingress.host}}
    ;hostname={{$.Values.trembita_config.trembita_frontend_pod.ingress.host}}


    ;[message-log]
    ;archive-storage-type = s3
    ;archive-interval=0 * * * * ? *

    ;[message-log-s3]
    ;bucket-name = uxp-messagelog
    ;access-key = scmyyP91huXNGdcGgLUu
    ;secret-key = jFiGQMn8pPngBFUFN1NcrxEjfWPKm11tIolVGmcm
    ;address = http://minio:9000

{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_identity_provider_rest_api.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_identity_provider_rest_api.name }}
data:
  {{default "uxp-identity-provider-rest-api-location.include" .uxp_identity_provider_rest_api.subPath}}: |
    # Identity Provider backend location.
    location /auth-api {
      proxy_pass http://{{ $.Values.trembita_config.trembita_identity_provider_rest_api_pod.name}}-service:8087;
    #  proxy_set_header Host $host:$server_port;
    #  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #  proxy_set_header X-Forwarded-Proto https;
    #  proxy_set_header X-Forwarded-Port $server_port;
    #  proxy_redirect http:// https://;
      client_max_body_size 5M;

      location ~* oauth2-redirect.html$ {
        proxy_pass http://{{ $.Values.trembita_config.trembita_identity_provider_rest_api_pod.name}}-service:8087;
    #    proxy_set_header Host $host:$server_port;
    #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #    proxy_set_header X-Forwarded-Proto https;
    #    proxy_set_header X-Forwarded-Port $server_port;
    #    proxy_redirect http:// https://;
    #    client_max_body_size 5M;
        add_header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; frame-ancestors 'self'; script-src 'self' 'unsafe-inline';" always;
      }
    }

{{- end }}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_seg_rest_api_ng_include.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_seg_rest_api_ng_include.name}}
data:
  {{default "uxp-securityserver-rest-api-location.include" .uxp_seg_rest_api_ng_include.subPath}}: |
    # REST API location.
      location /api {
        proxy_pass http://{{$.Values.trembita_config.trembita_seg_rest_api_pod.name}}-service:8085;
        #proxy_set_header Host $host:$server_port;
        #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #proxy_set_header X-Forwarded-Proto https;
        #proxy_set_header X-Forwarded-Port $server_port;
        #proxy_redirect http:// https://;
        #client_max_body_size 5M;

        location ~* oauth2-redirect.html$ {
          proxy_pass http://{{$.Values.trembita_config.trembita_seg_rest_api_pod.name}}-service:8085;
          #proxy_set_header Host $host:$server_port;
          #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          #proxy_set_header X-Forwarded-Proto https;
          #proxy_set_header X-Forwarded-Port $server_port;
          #proxy_redirect http:// https://;
          #client_max_body_size 5M;
          add_header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; frame-ancestors 'self'; script-src 'self' 'unsafe-inline';" always;
        }
      }
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_verifier_rest_api.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_verifier_rest_api.name}}
data:
  {{default "uxp-verifier-rest-api-location.include" .uxp_verifier_rest_api.subPath}}: |
    # REST API location.
    location /verifier-api {
      proxy_pass http://{{$.Values.trembita_config.trembita_verifier_pod.name}}-service:8086;
      proxy_set_header Host $host:$server_port;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      #proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-Port $server_port;
      #proxy_redirect http:// https://;
      client_max_body_size 5M;

      location ~* oauth2-redirect.html$ {
        proxy_pass http://{{$.Values.trembita_config.trembita_verifier_pod.name}}-service:8086;
        proxy_set_header Host $host:$server_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-Port $server_port;
        #proxy_redirect http:// https://;
        client_max_body_size 5M;
        add_header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; frame-ancestors 'self'; script-src 'self' 'unsafe-inline';" always;
      }
    }
{{- end}}
{{- end}}

{{/*------*/}}

{{/*{{- with .Values.trembita_config.configMaps}}*/}}
{{/*{{- if and .enabled .db_properties.enabled}}*/}}
{{/*apiVersion: v1*/}}
{{/*kind: ConfigMap*/}}
{{/*metadata:*/}}
{{/*  name: {{ .db_properties.name}}*/}}
{{/*data:*/}}
{{/*  {{default "db.properties" .db_properties.subPath}}: |*/}}
{{/*    serverconf.hibernate.jdbc.use_streams_for_binary = true*/}}
{{/*    serverconf.hibernate.connection.driver_class = org.postgresql.Driver*/}}
{{/*    serverconf.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/serverconf*/}}
{{/*    serverconf.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.SERVERCONF_DB_USER }}*/}}
{{/*    serverconf.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.SERVERCONF_DB_PASS }}*/}}
{{/*    messagelog-metadata.hibernate.connection.driver_class = org.postgresql.Driver*/}}
{{/*    messagelog-metadata.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/messagelog-metadata*/}}
{{/*    messagelog-metadata.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.MESSAGELOG_DB_USER }}*/}}
{{/*    messagelog-metadata.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.MESSAGELOG_DB_PASS }}*/}}
{{/*    identity-provider.hibernate.connection.driver_class = org.postgresql.Driver*/}}
{{/*    identity-provider.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/identity-provider*/}}
{{/*    identity-provider.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.IDENTITY_DB_USER }}*/}}
{{/*    identity-provider.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.IDENTITY_DB_PASS }}*/}}
{{/*    op-monitor.hibernate.jdbc.use_streams_for_binary = true*/}}
{{/*    op-monitor.hibernate.connection.driver_class = org.postgresql.Driver*/}}
{{/*    op-monitor.hibernate.jdbc.batch_size = 50*/}}
{{/*    op-monitor.hibernate.connection.url = jdbc:postgresql://{{ include "trembita-1-22-6-ss.fullname" $  }}-postgres:5432/op-monitor*/}}
{{/*    op-monitor.hibernate.connection.username = {{ $.Values.trembita_config.ss_to_db_access.OPMONITOR_DB_USER }}*/}}
{{/*    op-monitor.hibernate.connection.password = {{ $.Values.trembita_config.ss_to_db_access.OPMONITOR_DB_PASS }}*/}}
{{/*{{- end}}*/}}
{{/*{{- end}}*/}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_conf_client_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_conf_client_logback.name}}
data:
  {{ default "confclient-logback.xml" .uxp_conf_client_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">
      <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
          <encoder>
              <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
              <charset>UTF-8</charset>
          </encoder>
      </appender>

      <logger name="ee.cyber.uxp" level="INFO"/>

      <root level="INFO">
          <appender-ref ref="CONSOLE"/>
      </root>
    </configuration>

{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_message_log_archiver_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_message_log_archiver_logback.name}}
data:
  {{ default "messagelog-archiver-logback.xml" .uxp_message_log_archiver_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>
    </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_identity_provider_rest_api_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_identity_provider_rest_api_logback.name}}
data:
  {{ default "identity-provider-rest-api-logback.xml" .uxp_identity_provider_rest_api_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_ocsp_cache_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_ocsp_cache_logback.name}}
data:
  {{ default "ocsp-cache-logback.xml" .uxp_ocsp_cache_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_verifier_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_verifier_logback.name}}
data:
  {{ default "verifier-rest-api-logback.xml" .uxp_verifier_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_seg_rest_api_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_seg_rest_api_logback.name}}
data:
  {{ default "securityserver-rest-api-logback.xml" .uxp_seg_rest_api_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_proxy_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_proxy_logback.name}}
data:
  {{ default "proxy-logback.xml" .uxp_proxy_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_monitor_agent_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_monitor_agent_logback.name}}
data:
  {{ default "proxy-monitor-agent-logback.xml" .uxp_monitor_agent_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="DEBUG"/>

          <root level="DEBUG">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_monitor_agent_addon_logback.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_monitor_agent_addon_logback.name}}
data:
  {{ default "proxy-monitor-agent-logback.xml" .uxp_monitor_agent_addon_logback.subPath}}: |
    <?xml version="1.0" encoding="UTF-8" ?>
      <configuration scan="true" scanPeriod="30 seconds">

          <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                  <pattern>%d [%thread] %-5level %logger{36} - %msg%n</pattern>
                  <charset>UTF-8</charset>
              </encoder>
          </appender>

          <logger name="ee.cyber.uxp" level="INFO"/>

          <root level="INFO">
              <appender-ref ref="CONSOLE"/>
          </root>

      </configuration>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_anchor.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_anchor.name}}
data:
  {{ default "configuration-anchor.xml" .uxp_anchor.subPath}}: |
      <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
      <ns3:configurationAnchor xmlns:ns2="http://x-road.eu/xsd/identifiers" xmlns:ns3="http://x-road.eu/xsd/xroad.xsd">
          <generatedAt>2025-03-10T13:15:47.524Z</generatedAt>
          <instanceIdentifier>test1</instanceIdentifier>
          <source>
              <downloadURL>http://192.168.99.180/internalconf</downloadURL>
              <verificationCert>MIIBWjCB4KADAgECAgEBMAoGCCqGSM49BAMCMA4xDDAKBgNVBAMMA04vQTAeFw03MDAxMDEwMDAwMDBaFw0zODAxMDEwMDAwMDBaMA4xDDAKBgNVBAMMA04vQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABARD0p8U6kXze6tmVux2csWxTNHawwzphueTO+lJoUCqgXUv69EN7p1kAxTUbjfqIWjWTTzJYJEj/ofq3945uCoNAhFxsvsTOSSlxRjTGc17EBpE8YoYfaj3wQdqwTIreaMSMBAwDgYDVR0PAQH/BAQDAgZAMAoGCCqGSM49BAMCA2kAMGYCMQCiWn/Tzs7q62BOY180ED3a//8Gl2HkRpukooTdmfm1hU8HafsPq2/d3Gfj1V8pOmQCMQCvFvVOBaBrFirTVxPNl7R6fg2hPA8rL4mUtNGaJfpoi4Z8haVSlvAdiozuG4NFqlM=</verificationCert>
          </source>
          <source>
              <downloadURL>http://192.168.99.181/internalconf</downloadURL>
              <verificationCert>MIIBWTCB4KADAgECAgEBMAoGCCqGSM49BAMCMA4xDDAKBgNVBAMMA04vQTAeFw03MDAxMDEwMDAwMDBaFw0zODAxMDEwMDAwMDBaMA4xDDAKBgNVBAMMA04vQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABAZWm0DzpR+Nizfy+Vy/opYg7sguewvmujuExJg0fN53f/o6Kr+iaVwbkYqeKEUmEqIXAnucj9EQqeYMiVP6CL/8jT2xEuyd3qt8rNRybl2pPM8CNo7jCRwcgaruGp97oKMSMBAwDgYDVR0PAQH/BAQDAgZAMAoGCCqGSM49BAMCA2gAMGUCMQCYi8BCHVvEj9OXQeSZYhpJHgH6pb47gTbmiTWug3AvQQqh/1bj61C8wUaU24miFD8CMGwADMJtfcd2iTBNIsBR7ULyu43SxVgmPQ8cncc4J7o+j3PIhDTZiFdbgnYty5DE6A==</verificationCert>
          </source>
      </ns3:configurationAnchor>
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .uxp_license.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .uxp_license.name}}
data:
  {{ default "license.lic" .uxp_license.subPath}}: |
      --BOUNDARY
      content-id: UXP-LICENSE
      license-version: 2.0
      {
        "common": {
          "licenseNumber": "1355-4736-8876-9510",
          "licenseHolder": "Міністерство цифрової трансформації України",
          "validUntil": "2026-01-01"
        },
        "products": {
          "uxp-security-server": {
            "licensedOwners": [
              {
                "instances": [
                  "test1"
                ]
              }
            ],
            "maxClients": "unlimited"
          },
          "uxp-data-privacy-solution": {
            "licensedMembers": [
              {
                "instances": [
                  "test1"
                ]
              }
            ],
            "consentManagement": true,
            "maxServices": "unlimited",
            "maxProviders": "unlimited",
            "maxClients": "unlimited"
          }
        }
      }
      --BOUNDARY
      content-id: SIGNATURE
      signing-key: 035fdfc0-9b5e-4b78-9f73-bdc2d90363fe
      signing-algorithm: SHA512withRSA
      fPsTfASJ+OyEDuUvfnIKb64HlHlYkgJH3hvmuXK6ETLmGiErgl9NsNnBSZxhX8JIoFApAN1Tw9gWLM65A1DY51/ADgErQZz/xSHeNSueSFc7cLFe+PE3W7TMwMbhCN4Q+lNqyqJ0K2HBFrMbWuTHqltWnFMgvH1pn6vB2Wv87krqNZtA/ybPf6a1FH+dNuy2MD2AJBpAnIibQ8gXBeF3epa5TIFSJng6aUPGNcOIWoklKuFI6VLX0SpRfTjeENC+RV5m5MZ05YqDhah6mNIMvojcbH2//pqtpbsfo8yDrtSQYrGLgDj5SqTAMSq9+r/mARot6uctopnR1t+001z/6ul75tCOJe5FPNkIWByq/M5akE4ir924Eri2KXfT/WphpMifIkO6zwKLxmK5XSlDxvod5UWHS1fofvaIW2Rprp9ClcG+zjPY8a3oyYDrTyWUKK54i0wo/nZ3YDDlJvqLiw3E0k7QxWt9uYi9SXdtJl/09ubmfdAAPiIQ0uGc8VBO2Auf/AD4QWlFtp90Kx+JBBqj3dELZ5oJ8li+mjbkDzquYGGq/k64Z61Es0SG0aTs1lQSNcqsHXQ7zcWhqQG1YD8lQTYYMcx0QgHXltK+u9qxaViwHEWgKgihwrDH9hS9haU1lUdJ7N6ATx6RtflOq0+pUzvCTAbx5mLuoJ595aQ=
      --BOUNDARY--
{{- end}}
{{- end}}

------

{{- with .Values.trembita_config.configMaps}}
{{- if and .enabled .osplm_ini.enabled}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .osplm_ini.name}}
data:
  {{ default "osplm.ini" .osplm_ini.subPath}}: |
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301]
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules]
      [\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules\091]
      OrderNumber=0
      SN=091
      Address=192.168.99.236
      AddressMask=255.255.255.0
{{- end}}
{{- end}}