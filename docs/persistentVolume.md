## Описание: persistentStorage

`persistentStorage` — это постоянное хранилище, подключаемое к Pod на основе Kubernetes `PersistentVolumeClaim`, предназначенное для **одиночного использования** (доступен только одному Pod в момент времени). В отличие от `sharedVolumes`, `persistentStorage` не может быть смонтировано одновременно в нескольких Pod'ах.

---

### Текущие ограничения:

- На данный момент используется **только в `trembita_postgresql_pod`**.
- Также применяется в MinIO, но его конфигурация скрыта внутри Helm чарта Bitnami и **не описывается в данной документации**.
- **Не является универсальным решением** — требует ручного добавления шаблонов для каждого нового Pod.

---

### Пример конфигурации в `values.yaml`

```yaml
trembita_postgresql_pod:
  name: postgres
  image: postgres:16
  persistentStorage:
    - name: postgres                     # уникальное имя для PVC
      mountPath: /var/lib/postgresql/data # путь монтирования в контейнер
      size: 1Gi                          # размер PVC
      storageClass: ""                  # указание StorageClass (можно оставить пустым для дефолтного)
```

---

### Создание PVC

За создание PVC отвечает шаблон:

```
templates/postgres/postgresql-pvc.yaml
```

> Для добавления `persistentStorage` к другому компоненту:
> 1. Скопируйте `postgresql-pvc.yaml` в директорию соответствующего Pod.
> 2. Переименуйте файл.
> 3. Отредактируйте шаблон так, чтобы он брал значения из `values.yaml` вашего компонента.

---

### Access Modes

PVC создается с режимом доступа:

```yaml
accessModes:
  - ReadWriteOnce
```

Это означает, что том может быть **использован только одним Pod одновременно**.

---

### Особенности установки

Создание PVC возможно только во время установки Helm чарта благодаря аннотации:

```yaml
annotations:
  "helm.sh/hook": pre-install
```

Если вы обновляете чарт, уже установленный в кластере, **PVC не будет создан автоматически**.

---

### Вывод

- `persistentStorage` подходит для компонентов с **уникальным хранилищем**, например PostgreSQL.